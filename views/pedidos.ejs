<%- include('parcial/header') %>

<section class="checkout-container">
  <div class="checkout-card">
    <h1>Mis pedidos</h1>

    <% if (pedidos.length === 0) { %>
      <p>No tienes pedidos registrados.</p>
      <a href="/" class="btn-primary">Realizar pedido</a>
    <% } else { %>
      <ul class="order-list">
        <% pedidos.forEach(p => { %>
          <li class="order-item" style="margin-bottom:20px;">

            <% if (p.estado === 'borrador') { %>
              <form action="/pedidos/<%= p.id %>/agregar" method="POST" style="display:inline;">
                <select name="platoId" required>
                  <% platos.forEach(plato => { %>
                    <option value="<%= plato.id %>"><%= plato.nombre %></option>
                  <% }) %>
                </select>
                <input type="number" name="cantidad" min="1" value="1" required>
                <button type="submit">AÃ±adir</button>
              </form>

              <form action="/pedidos/<%= p.id %>/confirmar" method="POST" style="margin-top:8px;">
                <button type="submit">Confirmar este pedido</button>
              </form>
            <% } %>

            <p><strong>Platos del pedido:</strong></p>
            <ul>
              <% (detallesPorPedido[p.id] || []).forEach(d => { %>
                <li>
                  <%= d.nombre %> x <%= d.cantidad %>

                  <% if (p.estado === 'borrador') { %>
                    <form action="/pedidos/<%= p.id %>/detalles/<%= d.id %>/eliminar" method="POST" style="display:inline;">
                      <button type="submit">Quitar</button>
                    </form>
                 <% } %>
               </li>
              <% }) %>
            </ul>


            <p><strong>Fecha:</strong> <%= p.fecha.toLocaleString() %></p>
            <p><strong>Entrega:</strong> <%= (p.schedule_date || '') + ' ' + (p.schedule_slot || '') %></p>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>
</section>

<%- include('parcial/footer') %>




